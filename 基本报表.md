```sql

基本报表版本1
select count(zdtime) as 对话量 ,count(tel) as 留电量, count(zdtime) as 预约量, count(zdtime) as 到诊量
from hospital
group by zdr


基本报表版本2
更新内容：
1. select 后面第一列增加 zdr ，这样可以直接汇总到每个咨询头上，注意，select 后面的列名和 group by 后面的列是一样的。
2. count(zdtime) as 对话量 改为 count(*) as 对话量 ，统计一个表中有多少行的时候 用 *  是最准确、最省心的，不需要考虑 NULL 情况

select zdr as 制单人, count(*) as 对话量 ,count(tel) as 留电量, count(zdtime) as 预约量, count(zdtime) as 到诊量
from hospital
group by zdr


select
    zdr as 制单人,
    count(*) as 对话量 ,
    count(tel) as 留电量,
    count(zt where zt in ['精准预约', '不确定预约']) as 预约量,
    count(zt where zt = '已就诊') as 到诊量
from hospital
group by zdr
order by 对话量 desc

select
    zdr as 制单人,
    count(*) as 对话量 ,
    count(tel) as 留电量,
    count(zt when hospital.zt in ['精准预约', '不确定预约']) as 预约量,
    count(zt when hospital.zt  = '已就诊') as 到诊量
from hospital
group by zdr
order by 对话量 desc




其他：
1. order by tel 是错误的语句：ORDER BY 子句中的列 "hospital.tel" 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中

order by 留电量 是正确的，这说明必须使用别名？#FF0000
```

CREATE VIEW jbsj
AS
  SELECT hospital.zdtime                         AS 制单时间,
         hospital.tel                            AS 电话号码,
         dz.ghtime                               AS 挂号时间,
         hospital.yynr                           AS 预约内容,
         hospital.zdr                            AS 制单人,
         hospital.xm                             AS 姓名,
         hospital.zt                             AS 原始状态,
         dz.zt                                   AS 到诊状态,
         ( Rtrim(hospital.zzgjc) + ' '
           + Rtrim(hospital.gjc) + ' '
           + Rtrim(hospital.gjcfl) )             AS 症状,
         ( Rtrim(dz.zd1) + ' ' + Rtrim(dz.zd2) ) AS 诊断结果,
         sj.zt2                                  AS 详细状态,
         sj.yy1                                  AS 原因1,
         sj.yy2                                  AS 原因2,
         sj.yy3                                  AS 原因3,
         dz.czfz                                 AS 初诊复诊,
         dz.shoushu                              AS 是否手术
  FROM   hospital
         LEFT JOIN sj
                ON hospital.zdtime = sj.zdtime
         LEFT JOIN dz
                ON hospital.zdtime = dz.zdtime
  WHERE  hospital.zdtime BETWEEN '2017-07-01 00:00:00' AND '2017-09-28 00:00:00'

/*
返回3574行数据，包含重复的的换药的患者，一个病人多次换药，会多次记录
重复录入的患者，其制单时间是不一样的，同一个患者复诊，其制单时间是一样的，唯一的差别在于状态：已就诊 与 复诊
复诊的患者，重新录入，预约的时候，产生新的制单时间
周秀扣的患者也全部录入为复诊,其他专家的又是怎么统计的？
大肠水疗的也挂复诊
有那几种情况会挂复诊？老带新？
数量最多的要算同一个患者重复换药的，其他的要算初诊？

那么下面的代码，根据制单时间来统计，去除了同一个患者（同一个制单时间）复诊的情况
以制单时间为准！！！有没有其他的主键？？？

是否还会存在其他情况？
如果其他情况比较少，我们可以一个一个去找出来
但是在未知的情况下，如何去处理？

我们需要返回的数据是第一次就诊的数据，也就是 状态<>复诊  状态 = 已就诊？

在几年前的病人，现在到诊的问题怎么算？
回到最初的问题，咨询到诊状态、经营到诊状态是不一致的。
短时间 与 长时间 不同跨度下 汇总数据又该如何
根据就诊次数来算，第一次就诊，每次就诊包含多个状态：咨询初/复诊、经营初/复诊，规则如何制定的问题
*/


SELECT    hospital.zdtime    AS 制单时间,
          Count(dz.shoushu ) AS 是否手术
FROM      hospital
LEFT JOIN dz
ON        hospital.zdtime = dz.zdtime
GROUP BY  hospital.zdtime
--返回2列、3474条数据，相差100条数据，具体是哪些数据？


  SELECT hospital.tel                            AS 电话号码,
         dz.ghtime                               AS 挂号时间,
         hospital.yynr                           AS 预约内容,
         hospital.zdr                            AS 制单人,
         hospital.xm                             AS 姓名,
         hospital.zt                             AS 原始状态,
         dz.zt                                   AS 到诊状态,
         ( Rtrim(hospital.zzgjc) + ' '
           + Rtrim(hospital.gjc) + ' '
           + Rtrim(hospital.gjcfl) )             AS 症状,
         ( Rtrim(dz.zd1) + ' ' + Rtrim(dz.zd2) ) AS 诊断结果,
         sj.zt2                                  AS 详细状态,
         sj.yy1                                  AS 原因1,
         sj.yy2                                  AS 原因2,
         sj.yy3                                  AS 原因3,
         dz.czfz                                 AS 初诊复诊,
         dz.shoushu                              AS 是否手术
  FROM   hospital
         LEFT JOIN

(SELECT    hospital.zdtime    AS 制单时间,
          Count(dz.shoushu ) AS 是否手术
FROM      hospital
LEFT JOIN dz
ON        hospital.zdtime = dz.zdtime
GROUP BY  hospital.zdtime ) as tline

                ON hospital.zdtime = tline.制单时间
  WHERE  hospital.zdtime BETWEEN '2017-07-01 00:00:00' AND '2017-09-28 00:00:00'


多个左连接，遇到重复数据的问题:右表的数据比左表多，例如一个病人，有2个挂号记录
问题1:如何返回不重复的数据 DISTINCT 、 GROUP BY，1个列与多个列之间有什么区别？如何处理？
问题2:如何返回右侧需要的数据？或者是最新的数据？

COUNT 与 GROUP BY 之间的搭配组合，及列数量
COUNT 与 GROUP BY 形成子句 如何嵌套？